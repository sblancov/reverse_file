name: Release

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Follow Semantic Version (X.Y.Z)'
        required: true
        type: string


permissions:
  contents: write

jobs:
  release:

    name: Release a version
    runs-on: ubuntu-22.04
    defaults:
      run:
        working-directory: ./reverse_file

    steps:
    - uses: actions/checkout@v4
    - name: Set up Elixir
      uses: erlef/setup-beam@61e01a43a562a89bfc54c7f9a378ff67b03e4a21 # v1.16.0
      with:
        elixir-version: '1.15.7' # [Required] Define the Elixir version
        otp-version: '26.0'      # [Required] Define the Erlang/OTP version
    - name: Restore dependencies cache
      uses: actions/cache@v3
      with:
        path: deps
        key: ${{ runner.os }}-mix-${{ hashFiles('**/mix.lock') }}
        restore-keys: ${{ runner.os }}-mix-
    - name: Generate Executable
      run: mix escript.build
    - name: Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: exrev-${{ inputs.version }}
        path: cli
        if-no-files-found: error
        retention-days: 0
        compression-level: 6
        overwrite: false
        include-hidden-files: false
